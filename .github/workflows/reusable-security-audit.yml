name: Security Audit

on:
  workflow_call:
    secrets:
      SNYK_TOKEN:
        required: false

jobs:
  security-audit:
    name: Security Audit
    runs-on: ubuntu-latest
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v6

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '20'

      - name: ğŸ”’ npm audit
        run: npm audit --audit-level=high

      - name: ğŸ›¡ï¸ Snyk Security Scan
        if: ${{ env.SNYK_TOKEN != '' }}
        uses: snyk/actions/node@v1.0.0
        env:
          SNYK_TOKEN: ${{ env.SNYK_TOKEN }}

      - name: ğŸ“‹ OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@1.1.0
        with:
          path: '.'
          format: 'HTML'
